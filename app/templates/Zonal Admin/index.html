<!DOCTYPE html>
<html lang="en">
<head>
    {% load static %}
    {% include 'head.html' %}
    <meta charset="UTF-8">
    <title>Title</title>
    <link rel="stylesheet" href="{% static 'css/bootstrap.min.css' %}"/>
</head>
<body>
    <center>
        <h4>Doctor Appointments</h4>
    <div class="col-lg-12 mt-3 p-3">
        <table class="table table-responsive table-hover table-light">
            <tr>
                <th>Appointment Id</th>
                <th>Patient Name</th>
                <th>Patient Contact</th>
                <th>Booking Date Time</th>
                <th>Doctor Name</th>
                <th>Doctor Contact</th>
                <th>Query</th>
                <th>Status</th>
            </tr>
            {% for appointment in appointments %}
            <tr class="doctor-row-{{appointment.id}}">
                <td>{{appointment.id}}</td>
                <td>{{appointment.name}}</td>
                <td>{{appointment.phone}}</td>
                <td>{{appointment.datetime}}</td>
                <td>{{appointment.doctor__name}}</td>
                <td>{{appointment.doctor__phone}}</td>
                <td>{{appointment.query}}</td>
                <td>
                    <button class="btn btn-success done-appointment" data-doctor="{{appointment.id}}">Done</button>
                </td>
            </tr>
            {% endfor %}
        </table>
    </div>
    </center>
    <center>
        <h4>Paramedic Requests</h4>
    <div class="col-lg-12 mt-3 p-3">
        <table class="table table-responsive table-hover table-light">
            <tr>
                <th>Appointment Id</th>
                <th>Patient Name</th>
                <th>Patient Contact</th>
                <th>Booking Date Time</th>
                <th>Paramedic Name</th>
                <th>Paramedic Contact</th>
                <th>Query</th>
                <th>Status</th>
            </tr>
            {% for appointment in paramedic_bookings %}
            <tr class="paramedic-row-{{appointment.id}}">
                <td>{{appointment.id}}</td>
                <td>{{appointment.name}}</td>
                <td>{{appointment.phone}}</td>
                <td>{{appointment.datetime}}</td>
                <td>{{appointment.paramedic__name}}</td>
                <td>{{appointment.paramedic__phone}}</td>
                <td>{{appointment.query}}</td>
                <td>
                    <button class="btn btn-success done-paramedic" data-paramedic="{{appointment.id}}">Done</button>
                </td>
            </tr>
            {% endfor %}
        </table>
    </div>
    </center>
</body>
<script>
    $(".done-appointment").on('click',function(){
        type = "doctor";
        id = $(this).attr("data-doctor");
        done(type,id);
    });
    $(".done-paramedic").on('click',function(){
        type = "paramedic";
        id = $(this).attr("data-paramedic");
        done(type,id);
    });
    function done(type,id){
        $.ajax({
        url: "{% url 'done_appointment'  %}",
        data : {
            'id':id,
            'type':type,
        },
        type: 'GET',
        dataType: 'json',
        success: function(res) {
            console.log(res);
            if(type=="doctor")
            {
                $(".doctor-row-"+id).remove();
            }
            else{
                $(".paramedic-row-"+id).remove();
            }
        }
    });
    }
</script>
</html>
